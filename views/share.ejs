<!DOCTYPE HTML>
<html>

<head>
    <title>TelePrompter</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="javascript/jajax.js"></script>

    <link rel="stylesheet" href="stylesheets/kaltura-theme.css">
    <style>
        .center {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>

<body>
    <img id="spinner" src="images/spinner.png" class="center">
    <div id="kaltura-player" style="width: 95vw;height: 53.48vw;margin:auto;"></div>
    <br>
    <script type="text/javascript"
        src="https://cdnapisec.kaltura.com/p/<%=process.env.KALTURA_PARTNER_ID%>/embedPlaykitJs/uiconf_id/<%=process.env.KALTURA_PARTNER_ID%>/uiconf_id/<%=process.env.KALTURA_RECPLAYER_ID%>"></script>

    <script type="text/javascript">
        function poll() {
            $.getJSON("/status?entryId=<%=entryId%>", function (data) {
                if (data['ready']) {
                    $("#spinner").hide();
                    try {
                        var player = KalturaPlayer.setup({
                            targetId: "kaltura-player",
                            provider: {
                                partnerId: <%= process.env.KALTURA_PARTNER_ID %>,
                                uiConfId: <%= process.env.KALTURA_RECPLAYER_ID %>
                            }
                        });
                        //load first entry in player
                        player.loadMedia({ entryId: '<%= entryId%>' });
                    } catch (e) {
                        console.error(e.message)
                    }
                } else {
                    setTimeout(poll,3000);
                }
            }).done(function () {
                console.log("second success");
            }).fail(function (e) {
                console.error(e);
            }).always(function () {
                console.log("complete");
            });
        }
        poll();
    </script>
</body>

</html>